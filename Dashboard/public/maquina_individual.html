<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LogGuard - Dashboard</title>
  <link rel="stylesheet" href="./css/main.css">
  <link rel="stylesheet" href="./css/partials/SideBar.css">
  <link rel="stylesheet" href="./maquina_individual.css">
  <script src="js/sessao.js"></script>
  <link rel="shortcut icon" type="imagex/png" href="./img/logo_vetorizada6.png">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <div
  <section class="page-dash">
    <nav id="sidebar">
      <div id="sidebar_content">

        <li class="side_item" style="cursor: none;">
          <a>
            <i><img src="img/logo_roxa.png" class="nav-dash-icon" style="height: 90px; width: 90px;"></i>
            <span class="item-description">
              <b style="color: #442BB3; margin-left: 15px;"> Log Guard </b>
            </span>
          </a>
        </li>


        <div id="user">
          <p id="user_infos">
            <span style="color: black;" class="item-descriptionAtivo"> Ol치,
              <span style="color: #442BB3;" class="item-description" id="b_usuario">
                Jon Doe
              </span>
            </span>
            <span class="item-description " id="cargo_usuario" style="color: #442BB3;">
              Lorem Ipsum
            </span>
          </p>
        </div>

        <ul id="side_items">


          <li class="side_item ">
            <a href="dashboard_ADM.html">
              <i> <img src="./img/olho.png" class="nav-dash-icon" style="width: 25px;"> </i>
              <span class="item-description">
                <b> Vis칚o Geral </b>
              </span>
            </a>
          </li>

          <li class="side_item">
            <a href="relatorios.html">-----
              <i> <img src="./img/icon-cnpj.png" class="nav-dash-icon"> </i>
              <span class="item-description">
                <b> Relat칩rios </b>
              </span>
            </a>
          </li>

          <li class="side_item">
            <a href="gerenciar-maquina.html">
              <i> <img src="./img/monitor.svg" class="nav-dash-icon"> </i>
              <span class="item-description">
                <b> Empresas </b>
              </span>
            </a>
          </li>

          <li class="side_item">
            <a href="gerenciar-usuario-func.html">
              <i> <img src="./img/icon-man.png" class="nav-dash-icon"> </i>
              <span class="item-description">
                <b> Usu치rios </b>
              </span>
            </a>
          </li>

          <li class="side_item">
            <a href="gerenciar-usuario-func.html">
              <i> <img src="./img/icon-man.png" class="nav-dash-icon"> </i>
              <span class="item-description">
                <b> FeedBacks </b>
              </span>
            </a>
          </li>


          <li class="side_item active">
            <a href="dash_Gerenciamento_Operacao.html">
              <i> <img src="img/engrenagem_OperacaoBranco.png" class="nav-dash-icon"> </i>
              <span class="item-descriptionAtivo">
                <b style="color: aliceblue;"> Opera칞칫es </b>
              </span>
            </a>
          </li>

          <li>
            <div class="counter"><span id="counter" style="color: black;">00:00:00</span></div>
          </li>



          <li class="side_item">
            <a href="#">
              <i> <img src="./img/e-mail.png" class="nav-dash-icon" style="width: 25px;"> </i>
              <span class="item-description">
                <b> Ajuda </b>
              </span>
            </a>
          </li>
        </ul>

        <button id="open_btn">
          <i> <img src="./img/seta-direita.png" class="nav-dash-icon"> </i>
        </button>
      </div>

      <div id="logout">
        <button id="logout_btn" onclick="sair()">
          <i> <img src="img/sair.png" class="nav-dash-icon"> </i>
          <span class="item-description">
            Sair
          </span>
        </button>
      </div>
    </nav>

    <div style="width: 100%; margin: 16px; overflow: auto;"> <!--DIV AQUI 칍-->
      <!-- Se칞칚o de KPIs -->
      <div style="margin: 20px;">
        <h1 style="color: black; font-weight: bold;">Uso dos Componentes</h1>
        <p style="color: black; font-size: 18px;">M치quina:</p>
      </div>
      
      <div class="kpi-row">
        <div class="kpi-card">
          <div class="kpi-icon">%</div>
          <div class="kpi-info">
            <h3>Uso Do Disco</h3>
            <p class="value" id= "KPIDisc">41.8%</p>
            <p class="update">游댃 Update Now</p>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-icon">游늵</div>
          <div class="kpi-info">
            <h3>Uso da CPU</h3>
            <p class="value" id="KpiCPU"></p>
            <p class="update">游댃 Update Now</p>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-icon">游늳</div>
          <div class="kpi-info">
            <h3>Uso da RAM</h3>
            <p class="value">153 KB/s</p>
            <p class="update">游댃 Update Now</p>
          </div>
        </div>

       
      </div>

      <!-- Se칞칚o de Gr치ficos -->
      <div class="charts-row">
        <!-- Gr치fico de Alertas - CPU -->
        <div class="chart-box">
          <div class="chart-header">
            <h3 style="color: black;">Uso- CPU</h3>
          </div>
          <canvas id="cpuAlertsChart"></canvas>
        </div>
      
        <!-- Gr치fico de Alertas - Rede -->
        <div class="chart-box">
          <div class="chart-header">
            <h3 style="color: black;">Uso- Rede</h3>
          </div>
          <canvas id="redeAlertsChart"></canvas>
        </div>
        <!-- Bot칚o para abrir o modal -->
<button id="openModalBtn">Abrir Modal</button>

<!-- Modal -->
<div id="myModal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2>Bem-vindo ao Modal!</h2>
    <p>Este 칠 um modal de exemplo.</p>
  </div>
</div>
      </div>
      

     
      
      
      
  </section>

  <script src="js/maquina_individual.js"></script>
</body>

</html>

<script>

alert(sessionStorage.MAQUINA_SELECIONADA)

    document.addEventListener("DOMContentLoaded", function () {
        // Fun칞칚o para buscar o valor do KPI e exibir na p치gina
        function fetchKpi() {
            fetch('/kpi')
                .then(response => response.json())
                .then(data => {
                    // Atualiza o valor do KPI no painel
                    document.getElementById('KpiCPU').innerText = data;
                })
                .catch(error => console.error('Erro ao carregar o KPI:', error));
        }

        // Chama a fun칞칚o para atualizar o KPI quando a p치gina carregar
        fetchKpi();
    });



  var teste = 0

  document.getElementById('open_btn').addEventListener('click', function () {

    document.getElementById('sidebar').classList.toggle('open-sidebar');
    this.classList.toggle('rodar');

    if (teste == 0) {
      document.getElementById('nomeLog').style.display = "block";
      teste = 1
    } else {
      document.getElementById('nomeLog').style.display = "none";
      teste = 0
    }

  });

  function sair() {
    window.location.href = "index.html";
  }
</script>
<script>
  <!-- PARTE DO TIMER -------------------------------------------------------------------------------------------------------------- -->
  // Fun칞칚o para criar gr치ficos Gauge para os componentes
  

</script>

  <script>
var kpiCPU = document.getElementById("kpi-CPU");


function obterDadosCPU() {
  fetch(`/maquina_individualRota/ultimasCPU/`, { cache: 'no-store' }).then(function (response) {
      if (response.ok) {
          response.json().then(function (resposta) {
              console.log(`Dados recebidos DE CPU: ${JSON.stringify(resposta)}`);
              resposta.reverse();

              plotarGraficoCPU(resposta);

          });
      } else {
          console.error('Nenhum dado encontrado ou erro na API');
      }
  })
      .catch(function (error) {
          console.error(`Erro na obten칞칚o dos dados p/ gr치fico: ${error.message}`);
      });
};

function plotarGraficoCPU(resposta) {

  console.log('iniciando plotagem do gr치fico...');

  // Criando estrutura para plotar gr치fico - labels
  let labels = [];

  // Criando estrutura para plotar gr치fico - dados
  let dados = {
    labels: labels,
    datasets: [{
        label: 'Usada',
        data: [],
        backgroundColor: [],
        borderColor: ['#393d42'],
        tension: 0.3,
        fill: false, 
        pointRadius: 6
    }]
};

  console.log('----------------------------------------------')
  console.log('-------------------PLOT CPU---------------------')
  console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
  console.log(resposta)
// ...

// Dentro do seu loop for na fun칞칚o plotarGraficoDisco
for (i = resposta.length - 1; i >= 0; i--) {
    var registro = resposta[i];
    dados.datasets[0].data.push(registro.CPU);
    labels.push(registro.intervalo_tempo);
  
    if (registro.CPU != null) {
        // Atualize kpiDisco.textContent em vez de atribuir diretamente ao elemento
        kpiCPU.textContent = registro.CPU + '%';
    } else {
        kpiCPU.textContent = "Erro";
    }
   
    // Definindo a cor com base nas condi칞칫es
    if (registro.CPU <= 15) {
        dados.datasets[0].backgroundColor.push('#00FF00');
        // dados.datasets[0].borderColor.push('#00FF00');
    } else if (registro.CPU <= 39) {
        dados.datasets[0].backgroundColor.push('#f6ff00');
        // dados.datasets[0].borderColor.push('#f6ff00');
    } else {
        dados.datasets[0].backgroundColor.push('#FF0000');
        // dados.datasets[0].borderColor.push('#FF0000');
    }
  }
  
  // ...

  console.log('----------------------------------------------')
  console.log('O gr치fico ser치 plotado com os respectivos valores:')
  console.log('Labels:')
  console.log(labels)
  console.log('Dados:')
  console.log(dados.datasets)
  console.log('----------------------------------------------')

  // Criando estrutura para plotar gr치fico - config
  const config = {
    type: 'line',
    data: dados,
    fill: false,
  }
  
  // Adicionando gr치fico criado em div na tela
  let chartCPU = new Chart(
      document.getElementById(`chartCPU`),
      config
  );

  setTimeout(() => atualizarGraficoCPU(dados, chartCPU ), 5000);
};


function atualizarGraficoCPU(dados, chartCPU) {

  fetch(`/maquina_individualRota/tempoRealCPU/`, { cache: 'no-store' }).then(function (response) {
    if (response.ok) {
      response.json().then(function (novoRegistro) {

          if (novoRegistro[0].intervalo_tempo == dados.datasets[0].data.intervalo_tempo) {
              console.log("---------------------------------------------------------------")
              console.log("Como n칚o h치 dados novos para captura, o gr치fico n칚o atualizar치.")
              console.log("Hor치rio do novo dado capturado:")
              console.log(novoRegistro[0].intervalo_tempo)
              console.log("Hor치rio do 칰ltimo dado capturado:")
              console.log(dados.labels[dados.labels.length - 1])
              console.log("---------------------------------------------------------------")
          } else {
              // tirando e colocando valores no gr치fico
              dados.labels.shift(); // apagar o primeiro
              dados.labels.push(novoRegistro[0].intervalo_tempo); // incluir um novo momento

              dados.datasets[0].data.shift();  // apagar o primeira medida
              dados.datasets[0].data.push(novoRegistro[0].CPU); // incluir uma nova medida


              if(novoRegistro.CPU != null){
                kpiCPU = novoRegistro.CPU;
            } else {
                kpiCPU = "Erro"
              }
              
              chartCPU.update();
          }

          // Altere aqui o valor em ms se quiser que o gr치fico atualize mais r치pido ou mais devagar
          proximaAtualizacao = setTimeout(() => atualizarGraficoCPU(dados, chartCPU), 5000);
      });
  } else {
      console.error('Nenhum dado encontrado ou erro na API');
      // Altere aqui o valor em ms se quiser que o gr치fico atualize mais r치pido ou mais devagar
      proximaAtualizacao = setTimeout(() => atualizarGraficoCPU(dados, chartCPU), 5000);
  }
})
  .catch(function (error) {
      console.error(`Erro na obten칞칚o dos dados p/ gr치fico: ${error.message}`);
  });

};
  </script>
  