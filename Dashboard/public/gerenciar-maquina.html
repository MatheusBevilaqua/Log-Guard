<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LogGuard - Dashboard</title>
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="css/partials/SideBar.css">
    <script src="js/sessao.js"></script>   
    <link rel="shortcut icon" type="imagex/png" href="./img/logo_vetorizada6.png">
</head>

<body onload="validarCargo();validarSessao();visualizarMaquinas()">
    <section class="page-dash">
        <nav id="sidebar">
            <div id="sidebar_content">
                <div id="user">
                    <img src="https://static.wixstatic.com/media/3ce70f_1df652620b624e218f6ae076dd7b0aae~mv2.jpeg/v1/fill/w_163,h_245,al_c,q_80,usm_0.66_1.00_0.01,enc_auto/3ce70f_1df652620b624e218f6ae076dd7b0aae~mv2.jpeg" id="user_avatar" alt="Avatar">  
                
                    <p id="user_infos"> 
                        <span class="item-description" id="b_usuario"> 
                        </span>
                        <span class="item-description "id="cargo_usuario" style="color: #442BB3;"> 
                            Lorem Ipsum
                        </span>
                    </p>
    
                </div>    
            
                <ul id="side_items"> 
                    <li class="side_item active"> 
                        <a style="cursor: auto;">
                            <i><img src="img/logo_vetorizada6.png" class="nav-dash-icon" style="height: 40px; width: 40px;"></i>
                            <span class="item-description"> 
                                <b style="color: white;"> LOG GUARD </b> 
                            </span>    
                        </a>
                    </li>
            
                    <li class="side_item"> 
                        <a href="dashboard_ADM.html">
                            <i> <img src="./img/olho.png" class="nav-dash-icon" style="width: 25px;"> </i>
                            <span class="item-description"> 
                               <b> Visão Geral </b> 
                            </span>    
                        </a>
                    </li>
            
                    <li class="side_item"> 
                        <a href="relatorios.html">
                            <i> <img src="./img/icon-cnpj.png" class="nav-dash-icon"> </i>
                            <span class="item-description"> 
                               <b> Relatórios </b> 
                            </span>    
                        </a>
                    </li>
            
                    <li class="side_item"> 
                        <a href="gerenciar-maquina.html">
                            <i> <img src="./img/monitor.svg" class="nav-dash-icon"> </i>
                            <span class="item-description"> 
                                <b> Máquinas </b>
                            </span>    
                        </a>
                    </li>
            
                    <li class="side_item"> 
                        <a href="gerenciar-usuario-func.html">
                            <i> <img src="./img/icon-man.png" class="nav-dash-icon"> </i>
                            <span class="item-description"> 
                                <b> Funcionários </b>
                            </span>    
                        </a>
                    </li>
            
                    <li class="side_item"> 
                        <a href="#">
                            <i> <img src="./img/e-mail.png" class="nav-dash-icon" style="width: 25px;"> </i>
                            <span class="item-description"> 
                                <b> Ajuda </b>
                            </span>    
                        </a>
                    </li>
            
                    <!-- <li class="side_item"> 
                        <a href="#">
                            <i class="fa-solid fa-gear"></i>
                            <span class="item-description"> 
                                <b> </b>
                            </span>    
                        </a>
                    </li> -->
                </ul>
            
                <button id="open_btn">
                    <i> <img src="./img/seta-direita.png" class="nav-dash-icon"> </i>
                </button>
            </div>
    
            <div id="logout">
                <button id="logout_btn" onclick="sair()">
                    <i> <img src="img/sair.png" class="nav-dash-icon"> </i>
                    <span class="item-description"> 
                        Sair 
                    </span>
                </button>
            </div>
    </nav>
    <!-- <aside class="nav-dash">
        <div class="nav-dash-logo">
            <img src="./svg/iceberg-preto-com-texto.svg" class="nav-dash-logo" alt="Logo LogGuard">
        </div>

        <ul class="nav-dash-list">
            <a href="dashboard_ADM.html">
            <li class="nav-dash-link" href=""><img src="./svg/key-icon.svg" class="nav-dash-icon" style="padding-left: 3%;">Visão
                    Geral</li>
            </a>
            <a href="relatorios.html">
            <li class="nav-dash-link"><img src="./img/icon-cnpj.png" class="nav-dash-icon" style="padding-left: 3%;">Relatórios
                </li>
            </a>
            <a href="gerenciar-maquina.html">
            <li class="nav-dash-link"><img src="./img/monitor.svg" class="nav-dash-icon" style="padding-left: 3%;">Máquinas</li>
            </a>
            <a href="gerenciar-usuario-func.html">
                <li class="nav-dash-link"><img src="./img/icon-man.png" class="nav-dash-icon">Funcionários</li>
            </a>
            <a href="index.html">
            <li class="nav-dash-link-sair"><img src="./img/sair.png" class="nav-dash-icon" style="padding-left: 3%;">Sair</li>
            </a>
        </ul>
        </nav>
        </nav>
    </aside> -->
    <section class="page-dash-geren" onload="validarSessao()">
    
        <div class="maingerenpage">
            <h1>Gerenciar Máquinas:</h1>
            <div class="select-geren">
                <select name="select">
                    <div class="select-items-geren">
                        <option value="valor1" selected disabled>Filtrar por</option>
                        <option value="valor2">Crescente</option>
                        <option value="valor3">Decrescente</option>
                    </div>
                </select>
            </div>
            <div class="dash-geren">
                <div class="titulos-geren">
                    <div class="coluna-geren">ID</div>
                    <div class="coluna-geren">Nome</div>
                    <div class="coluna-geren">CPU</div>
                    <div class="coluna-geren">Memória</div>
                    <div class="coluna-geren">Disco</div>
                    <div class="coluna-geren">Localidade</div>
                    <div class="coluna-geren">Endereço MAC</div>
                </div>
                <div class="linha-geren">
                    <img src="./img/Line1cadastro.png" alt="">
                </div>
                <div class="geren-dados" id="geren-dados"> 
                    
                </div>
            </div>
            <div class="botoes-geren">
                <!-- <button onclick="editar_maquina()" class="edit-geren">Editar</button> -->
                <button onclick="cadastrar_maquina()" class="cad-geren">Cadastrar</button>
            </div>
        </div>
    
        <div class="Editargeren">
            <div class="Editar-geren-primeiro">
                <h1>Alterar as configurações do servidor:</h1>
                <div class="configuracoes-servidores">
                <div class="titulos-maquina-atribuicao">
                <p>Nome da máquina</p>
                </div>
                <input placeholder="Ex: HLE-STEP2" type="text" id="input_alterar_nome">
                <img src="./img/Line1cadastro.png" alt="">
                <div class="titulos-maquina-atribuicao">
                <p>Modelo da CPU</p>
            </div>
                <input placeholder="Ex: Ryzen 5 1600AF" type="text" id="input_alterar_modeloCPU">
                <img src="./img/Line1cadastro.png" alt="">
                <div class="titulos-maquina-atribuicao">
                <p>RAM(Gb)</p>
            </div>
                <input placeholder="Ex: 500" type="text" id="input_alterar_capacidadeRAM">
                <img src="./img/Line1cadastro.png" alt="">
                <div class="titulos-maquina-atribuicao">
                <p>Disco(TB)</p>
            </div>
                <input placeholder="Ex: 20" type="text" id="input_alterar_disco">
                <img src="./img/Line1cadastro.png" alt="">
                <div class="titulos-maquina-atribuicao">
                <p>Localidade</p>
            </div>
                <input placeholder="Ex: Datacenter 5" type="text" id="input_alterar_localidade">
                <img src="./img/Line1cadastro.png" alt="">
            </div>
        </div>
           
    
            <div class="Editar-geren-segundo">
                <div class="Editar-geren-confirmudanca">
    
                    <input type="checkbox" id="input_alterar_checkbox">
                    <label for="input_alterar_checkbox">Confirmar mudanças</label><br>
                </div>


                <div class="Editar-geren-botoes">
                    <button onclick="confirmar_editar()" class="confirmar-geren">Confirmar</button>
                    <button onclick="cancelar_editar()" class="cancelar-geren">X</button>
                </div>
            </div>
            <img src="./img/Line1cadastro.png" class="line1-geren" alt="">
            <div class="editar-geren-titulodelet">
                <h1>Excluir servidor:</h1>
            </div>
            <div class="Editar-geren-botao-delete">
                <button onclick="excluir_editar()" class="confirmar-geren">Excluir Servidor</button>
            </div>
        </div>
    
        <div class="Cadastrargeren">
            <h1>Complete os campos:</h1>
            <div class="cadastrar-geren-primeiro">
                <input placeholder="Nome da máquina" type="text" id="nome_input">
                <img src="./img/Line1cadastro.png" alt="">
                <input placeholder="Modelo da CPU" type="text" id="modeloCPU_input">
                <img src="./img/Line1cadastro.png" alt="">
                <input placeholder="RAM(Gb)" type="text" id="capacidadeRAM_input">
                <img src="./img/Line1cadastro.png" alt="">
                <input placeholder="Disco(TB)" type="text" id="disco_input">
                <img src="./img/Line1cadastro.png" alt="">
                <input placeholder="Localidade" type="text" id="localidade_input">
                <img src="./img/Line1cadastro.png" alt="">
                <input placeholder="Endereço MAC" type="text" id="MACAdress_input">
                <img src="./img/Line1cadastro.png" alt="">
    
            </div>
            <div class="cadastrar-geren-segundo">
                <input type="checkbox" id="input_cadastro_checkbox">
                <label for="input_cadastro_checkbox">Confirmar criação</label>
            </div>
            <div class="cadastrar-geren-terceiro">
                <button onclick="confirmar_cadastrar()" class="confirmar-geren">Confirmar</button>
                <button onclick="cancelar_cadastrar()" class="cancelar-geren">Cancelar</button>
            </div>
        </div>
        </div>
    </section>
</body>

</html>

<script>

document.getElementById('open_btn').addEventListener('click', function (){
document.getElementById('sidebar').classList.toggle('open-sidebar');
                     });

    function sair(){
    window.location.href = "index.html";
    }
    var idEmpresaUsuario = sessionStorage.EMPRESA_USUARIO
    var idMaquina = ""

    function confirmar_editar() {
        // temporario
        document.querySelector('.maingerenpage').style.filter = "blur(0px)";
        document.querySelector('.Editargeren').style.display = "none";
        window.location.reload(true); //reload na página
        {
 var r = confirm("Tem certeza que deseja alterar este perfil?");
    if (r == true) {
       editarMaquina();
    } else {
        alert("Algo deu errado na alteração de perfil!");
    }
}
    }



    function cancelar_editar() {
        document.querySelector('.maingerenpage').style.filter = "blur(0px)";
        document.querySelector('.Editargeren').style.display = "none";
    }

    function excluir_editar() {
        var r = confirm("Tem certeza que deseja excluir este servidor?");
        if (r == true) { 
            deletarMaquina()
            window.location.reload(true); //reload na página
        }
    }

    function confirmar_cadastrar() {


        var nomeMaquinaVAR = nome_input.value;
        var modeloCPUVAR = modeloCPU_input.value;
        var capacidadeRAMVAR = capacidadeRAM_input.value;
        var discoVAR = disco_input.value;
        var localidadeVAR = localidade_input.value;
        var MACAdressVAR = MACAdress_input.value;



        if (
            nomeMaquinaVAR == "" ||
            modeloCPUVAR == "" ||
            capacidadeRAMVAR == "" ||
            discoVAR == "" ||
            localidadeVAR == "" ||
            MACAdressVAR == ""
        ) {
            alert("Todos os campos dever ser preenchidos!")
            return false;
        } else {

            fetch("/empresas/confirmar_cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({

                    nomeMaquinaServer: nomeMaquinaVAR,
                    modeloCServer: modeloCPUVAR,
                    capacidadeServer: capacidadeRAMVAR,
                    discoServer: discoVAR,
                    localidadeServer: localidadeVAR,
                    MACAdressServer: MACAdressVAR,
                    fkEmpresaMaquinaServer: sessionStorage.EMPRESA_USUARIO
                }),
            })
                .then(function (resposta) {
                    console.log("resposta: ", resposta);

                    if (resposta.ok) {

                        alert("CADASTRO EXECUTADO!")

                    } else {
                        throw "Houve um erro ao tentar realizar o cadastro!";
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);

                });

            return false;
        }
        // temporario
        document.querySelector('.maingerenpage').style.filter = "blur(0px)";
        document.querySelector('.Cadastrargeren').style.display = "none";
    }

    function cancelar_cadastrar() {
        document.querySelector('.maingerenpage').style.filter = "blur(0px)";
        document.querySelector('.Cadastrargeren').style.display = "none";
    }


    function cadastrar_maquina() {
        document.querySelector('.maingerenpage').style.filter = "blur(5px)";
        document.querySelector('.Cadastrargeren').style.display = "block";

    }
    // function publicar_relatorio() {
    //     document.querySelector('.maingerenpage').style.filter = "blur(5px)";
    //     document.querySelector('.Cadastrargeren').style.display = "block";

    // }
    function visualizarMaquinas() {
        fetch("/empresas/visualizarMaquinas", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idEmpresaMaquinaServer: idEmpresaUsuario
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    if (resposta.status == 204) {
                        var lista = document.getElementById("dash-func");
                        var mensagem = document.createElement("span");
                        mensagem.innerHTML = "Nenhuma máquina encontrada."
                        throw "Nenhum resultado encontrada!!";
                    }

                    resposta.json().then(function (resposta) {
                        console.log("Dados recebidos: ", JSON.stringify(resposta));

                        var lista = document.getElementById("geren-dados");


                        for (let i = 0; i < resposta.length; i++) {

                            let tupla = resposta[i];
                            var divLista = document.createElement("div");
                            var divId = document.createElement("div");
                            var divnome = document.createElement("div");
                            var divCPU = document.createElement("div");
                            var divRAM = document.createElement("div");
                            var divDisco = document.createElement("div");
                            var divLocalidade = document.createElement("div");
                            var divMAC = document.createElement("div");

                            divLista.className = "dados-geren";
                            divId.className = "coluna-geren";
                            divnome.className = "coluna-geren";
                            divCPU.className = "coluna-geren";
                            divRAM.className = "coluna-geren";
                            divDisco.className = "coluna-geren";
                            divLocalidade.className = "coluna-geren";
                            divMAC.className = "coluna-geren";

                            divId.innerHTML = tupla.idMaquina;
                            divnome.innerHTML = tupla.nomeMaquina;
                            divCPU.innerHTML = tupla.modeloCPU;
                            divRAM.innerHTML= tupla.capacidadeRAM;
                            divDisco.innerHTML = tupla.disco;
                            divLocalidade.innerHTML = tupla.localidade;
                            divMAC.innerHTML = tupla.MACAdress;


                            divLista.appendChild(divId);
                            divLista.appendChild(divnome);
                            divLista.appendChild(divCPU);
                            divLista.appendChild(divRAM);
                            divLista.appendChild(divDisco);
                            divLista.appendChild(divLocalidade);
                            divLista.appendChild(divMAC);

                            let debounceTimeout;
                            divLista.addEventListener("click", function() {
                            if (debounceTimeout) {
                                clearTimeout(debounceTimeout);
                            }

                            debounceTimeout = setTimeout(function() {
                                gerenciarMaquina(tupla.idMaquina);
                             }, 200); 
                            });

                            
                             lista.appendChild(divLista);
                        }

                    });
                } else {
                    throw ('Houve um erro na API!');
                }
            }).catch(function (resposta) {
                console.error(resposta);
            });
    }

    function gerenciarMaquina(idMaquinaSelecionada) {

    idMaquina = idMaquinaSelecionada

    fetch("/empresas/exibirDadosEdicaoMaquina", {
    method: "POST",
    headers: { 
        "Content-Type": "application/json",
    },
    body: JSON.stringify({ 
        idMaquinaServer: idMaquinaSelecionada,
    }),
    })
    .then(function (resposta) {
    if (resposta.ok) {
        resposta.json().then(function (json) {

            let nomeMaquinaEdicao = json.nomeMaquina;
            let modeloCPUMaquinaEdicao = json.modeloCPU;
            let capacidadeRAMaquinaEdicao = json.capacidadeRAM;
            let discoMaquinaEdicao = json.disco;
            let localidadeMaquinaEdicao = json.localidade;


            document.getElementById("input_alterar_nome").value = nomeMaquinaEdicao;
            document.getElementById("input_alterar_modeloCPU").value = modeloCPUMaquinaEdicao;
            document.getElementById("input_alterar_capacidadeRAM").value = capacidadeRAMaquinaEdicao;
            document.getElementById("input_alterar_disco").value = discoMaquinaEdicao;
            document.getElementById("input_alterar_localidade").value = localidadeMaquinaEdicao;

              document.querySelector('.maingerenpage').style.filter = "blur(5px)";
            document.querySelector('.Editargeren').style.display = "block";


        });
    } else {
        console.error("Houve um erro na requisição");
    }
    })
    .catch(function (erro) {
    console.error("Erro ao tentar buscar os dados do usuário:", erro);
    });

    return false;
    }

    function deletarMaquina() {
    alert("ID da selecionado: " + idMaquina);
    
    fetch("/empresas/deletarMaquina", {
        method: "DELETE",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
            idMaquinaServer: idMaquina,
        }),
    })
    .then(function (resposta) {
        if (resposta.ok) {
            resposta.json().then(function (json) {
                console.log("Máquina deletada com sucesso:", json);
                verUsuarios();
            });
        } else {
            console.error("Houve um erro na requisição");
        }
    })
    .catch(function (erro) {
        console.error("Erro ao tentar deletar a máquina:", erro);
    });

    return false;
}
function editarMaquina() {

    var nomeMaquinaVAR = input_alterar_nome.value;
    var modeloCPUVAR = input_alterar_modeloCPU.value;
    var capacidadeRAMVAR =  input_alterar_capacidadeRAM.value;
    var discoVAR =  input_alterar_disco.value;
    var localidadeVAR = input_alterar_localidade.value;

    if (
            nomeMaquinaVAR == "" ||
            modeloCPUVAR == "" ||
            capacidadeRAMVAR == "" ||
            discoVAR == "" ||
            localidadeVAR == "" 
        ) {
            alert("Todos os campos dever ser preenchidos!")
            return false;
        } else {

       
    console.log("Dados a serem enviados:", {
        nomeMaquinaServer: nomeMaquinaVAR,
        modeloCPUServer: modeloCPUVAR,
        capacidadeRAMServer: capacidadeRAMVAR,
        discoServer: discoVAR,
        localidadeServer: localidadeVAR,
    });
    fetch("/empresas/editarMaquina", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify({
            idMaquinaServer: idMaquina,
            nomeMaquinaServer: nomeMaquinaVAR,
            modeloCPUServer: modeloCPUVAR,
            capacidadeRAMServer: capacidadeRAMVAR,
            discoServer: discoVAR,
            localidadeServer: localidadeVAR,
        }),
    })
    .then(function (resposta) {
        console.log("Status da resposta:", resposta.status);
        if (resposta.ok) {
            alert("teste 02")

            resposta.json().then(function (json) {
                console.log("Máquina atualizada com sucesso:", json);
                alert("Perfil alterado com sucesso!");
                window.location.reload(true);
            });
        } else {
            resposta.text().then(function (texto) {
                console.error("Erro na resposta:", texto);
            });
        }
    })
    .catch(function (erro) {
        console.error("Erro ao tentar alterar os dados da máquina:", erro);
    });
}
}



</script>