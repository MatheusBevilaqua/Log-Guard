<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LogGuard - Dashboard</title>
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="css/partials/SideBar.css">
    <link rel="stylesheet" href="css/partials/dialog.css">
    <script src="js/sessao.js"></script>
    <link rel="shortcut icon" type="imagex/png" href="./img/logo_vetorizada6.png">
</head>

<!-- <body onload="validarCargo();validarSessao();verUsuarios(); totalfunc(); totaladms(); totalanalista(); verMaquinas(), filtrarCargo"> -->
    <section class="page-dash">
        <nav id="sidebar">
            <div id="sidebar_content">
                <div id="user">
                    <img src="https://apexensino.com.br/wp-content/uploads/2019/02/iStock-1017296544-1024x683.jpg"
                        id="user_avatar" alt="Avatar">

                    <p id="user_infos">
                        <span class="item-description" id="b_usuario">
                        </span>
                        <span class="item-description " id="cargo_usuario" style="color: #442BB3;">
                            Lorem Ipsum
                        </span>
                    </p>

                </div>

                <ul id="side_items">
                    <li class="side_item active">
                        <a style="cursor: auto;">
                            <i><img src="img/logo_vetorizada6.png" class="nav-dash-icon"
                                    style="height: 40px; width: 40px;"></i>
                            <span class="item-description">
                                <b style="color: white;"> LOG GUARD </b>
                            </span>
                        </a>
                    </li>

                    <li class="side_item">
                        <a href="dashboard_ADM.html">
                            <i> <img src="./img/olho.png" class="nav-dash-icon" style="width: 25px;"> </i>
                            <span class="item-description">
                                <b> Visão Geral </b>
                            </span>
                        </a>
                    </li>

                    <li class="side_item">
                        <a href="relatorios.html">
                            <i> <img src="./img/icon-cnpj.png" class="nav-dash-icon"> </i>
                            <span class="item-description">
                                <b> Relatórios </b>
                            </span>
                        </a>
                    </li>

                    <li class="side_item">
                        <a href="gerenciar-maquina.html">
                            <i> <img src="./img/monitor.svg" class="nav-dash-icon"> </i>
                            <span class="item-description">
                                <b> Máquinas </b>
                            </span>
                        </a>
                    </li>

                    <li class="side_item">
                        <a href="gerenciar-usuario-func.html">
                            <i> <img src="./img/icon-manBranco.png" class="nav-dash-icon"> </i>
                            <span class="item-description">
                                <b> Funcionários </b>
                            </span>
                        </a>
                    </li>

                    <li class="side_item">
                        <a href="#">
                            <i> <img src="./img/e-mail.png" class="nav-dash-icon" style="width: 25px;"> </i>
                            <span class="item-description">
                                <b> Ajuda </b>
                            </span>
                        </a>
                    </li>
                </ul>

                <button id="open_btn">
                    <i> <img src="./img/seta-direita.png" class="nav-dash-icon"> </i>
                </button>
            </div>

            <div id="logout">
                <button id="logout_btn" onclick="sair()">
                    <i> <img src="img/sair.png" class="nav-dash-icon"> </i>
                    <span class="item-description">
                        Sair
                    </span>
                </button>
            </div>
        </nav>

        <section class="page-dash-func">

            <dialog class="dialogodefiltromaquina">
                <div class="dialogodefiltromaquinatitulo">
                    <h2>Filtrar por</h2>
                    <div class="Editarbotaofechar">
                        <button onclick="cancelar_filtro()" class="cancelarfiltro">X</button>
                    </div>
                </div>
                <div class="regiaocentrofiltros">
                    <div class="regiaocentrofiltros-particao1">

                        <div class="particao1-inputselect">
                            <p>Funcionários com o cargo:</p>
                            <select name="select1">
                                <option value="valor0" disabled selected>Selecione o cargo</option>
                                <option value="valor1">Analista</option>
                                <option value="valor2">Administrador</option>
                            </select>
                        </div>

                        <div class="particao1-inputselect">
                            <p>Funcionários atribuidos a maquina:</p>
                            <select name="select2">
                                <option value="valor0" disabled selected>Selecione a máquina</option>
                                <option value="valor1">HGL-02</option>
                                <option value="valor2">Amazon ec2-pp02</option>
                            </select>
                        </div>
                    </div>
                    <div class="regiaocentrofiltros-particao2">
                        <div class="particao1-inputselect">
                            <p>Selecione a opção de filtro</p>
                            <select id="select2" onchange="selectFiltro()">
                                <option id="valor0" value="valor0" disabled selected>Selecione o filtro</option>
                                <option id="valor1" value="valor1">ID funcionário</option>
                                <option id="valor2" value="valor2">Nome do funcionário</option>
                                <option id="valor3" value="valor3">Tempo de registro</option>
                            </select>
                        </div>
                        <div class="particao-maquinafiltro-1" style="display: none;">
                            <div class="particao2-inputitulo">
                                <p>ID funcionário</p>
                            </div>
                            <div class="particao2-grupocheckbox">
                                <div class="particao2-inputcheckbox">
                                    <input id="check1" type="checkbox" onclick="toggleCheckbox(this)">
                                    <p>Crescente</p>
                                </div>
                                <div class="particao2-inputcheckbox">
                                    <input id="check2" type="checkbox" onclick="toggleCheckbox(this)">
                                    <p>Decrescente</p>
                                </div>
                            </div>
                        </div>
                        <div class="particao-maquinafiltro-2" style="display: none;">
                            <div class="particao2-inputitulo">
                                <p>Nome do funcionário</p>
                            </div>
                            <div class="particao2-grupocheckbox">
                                <div class="particao2-inputcheckbox">
                                    <input id="check3" type="checkbox" onclick="toggleCheckbox(this)">
                                    <p>de A até Z</p>
                                </div>
                                <div class="particao2-inputcheckbox">
                                    <input id="check4" type="checkbox" onclick="toggleCheckbox(this)">
                                    <p>de Z até A</p>
                                </div>
                            </div>
                        </div>
                        <div class="particao-maquinafiltro-3" style="display: none;">
                            <div class="particao2-inputitulo">
                                <p>Tempo de registro</p>
                            </div>
                            <div class="particao2-grupocheckbox">
                                <div class="particao2-inputcheckbox">
                                    <input id="check5" type="checkbox" onclick="toggleCheckbox(this)">
                                    <p>Maior tempo</p>
                                </div>
                                <div class="particao2-inputcheckbox">
                                    <input id="check6" type="checkbox" onclick="toggleCheckbox(this)">
                                    <p>Menor tempo</p>
                                </div>
                            </div>
                        </div>
                        <div class="filtro-botao-confirmar">
                            <button onclick="confirmar_filtrar()" class="confirmarfiltro">Filtrar</button>
                        </div>
                    </div>
                </div>
            </dialog>


            <div class="mainfuncpage">
                <div class="head-funcionarios-gerenc">

                    <h1>Gerenciar Funcionários:</h1>

                    <button onclick="filtrarporfunc()" class="botao-filtro">Filtrar </button>

                </div>


                <div class="metricas-func">


                    <div class="dash-func">

                        <div class="titulos-func">
                            <div class="coluna-func">ID</div>
                            <div class="coluna-func">Nome</div>
                            <div class="coluna-func">E-Mail</div>
                            <div class="coluna-func">Cargo</div>
                        </div>
                        <div class="linha-func">
                            <img src="./img/Line1cadastro.png" alt="">
                        </div>
                        <div class="dash-func">
                            <div id="dash-func"></div>
                        </div>
                    </div>
                    <div class="tre-func">
                        <div class="me1-func">
                            <h5>Total de funcionários:</h5>
                            <br><br>
                            <div class="totalfuncs" id="totalfuncionarios"></div>
                            <div class="me2-func">
                                <h5>Administradores:</h5>
                                <br>
                                <div class="totalfuncs" id="totaladms">0</div>

                                <div class="me3-func">
                                    <h5>Analistas:</h5>
                                    <br><br>
                                    <div class="totalfuncs" id="totalanalista">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="botoes-func">
                    <!-- <button onclick="editar_gefunc()" class="edit-func">Editar</button> -->
                    <button onclick="cadastrar_gefunc()" class="cad-func">Cadastrar Funcionário</button>
                </div>
            </div>


            <!-- EDITAR FUNCIONÁRIO ----------------------------------------------------------------------------------- -->
            <div class="Editarfunc">
                <h1>Alterar as configurações do perfil:</h1>
                <div class="Editar-func-primeiro">
                    <div class="divisorias-maquinas-1">
                        <p>Nome Completo</p>
                        <input placeholder="Ex: John Doe" type="text" id="input_alterar_nome">
                        <p>E-Mail</p>
                        <input placeholder="Ex: johndoe@dominio.com" type="text" id="input_alterar_email">
                    </div>

                    <div class="divisorias-maquinas-2">
                        <p>Selecione o cargo do perfil</p>
                        <div class="select-func-primeiro">
                            <select id="select_alterar_cargo">
                                <option value="" disabled>Selecionar cargo</option>
                                <option value="COMUM">COMUM</option>
                                <option value="ADMINISTRADOR">ADMINISTRADOR</option>
                            </select>

                        </div>
                        <p>Senha</p>
                        <input placeholder="Ex: ******" type="password" id="input_alterar_senha">
                    </div>

                </div>
                <div class="editar-func-titulodelet">
                </div>
                <div class="Editar-func-botao-editar">
                    <button onclick="atribuicao_maquina_gefunc()" class="editar-func">Atribuição de Máquinas</button>
                </div>
                <!-- <img src="./img/Line1cadastro.png" class="linhacad"> -->
                <div class="Editar-func-botao-delete">
                    <button onclick="atribuicao_editar_gefunc()" class="editar-func">Editar Perfil</button>
                    <button onclick="excluir_editar_gefunc()" class="excluir-func">Excluir Perfil</button>
                </div>
                <div class="Editar-func-botao-fechar">
                    <button onclick="fechar_gefunc()" class="fechar-func">X</button>
                </div>
            </div>
            <!-- FIM EDITAR FUNCIONÁRIO ----------------------------------------------------------------------------------- -->
            <div class="Cadastrarfunc">
                <h1>Complete os campos:</h1>

                <div class="cadastrar-func-primeiro">
                    <div class="divisorias-titulos-maquinas-1">

                        <div class="titulos-maquina-atribuicao">
                            <p>Nome completo do funcionário</p>
                        </div>
                        <input placeholder="Ex: John Doe" type="text" id="input_nome_func">
                        <div class="titulos-maquina-atribuicao">
                            <p> Email funcionário</p>
                        </div>
                        <input placeholder="Ex: johndoe@dominio.com" type="text" id="input_email_func">
                        <div class="titulos-maquina-atribuicao">
                            <p>Cargo funcionário</p>
                        </div>
                        <div class="select-func-segundo">
                            <select id="lista_cargo" name="select">
                                <option value="" selected disabled>Selecionar cargo</option>
                                <option value="COMUM">COMUM</option>
                                <option value="ADMINISTRADOR">ADMINISTRADOR</option>
                            </select>
                        </div>

                    </div>

                    <div class="divisorias-titulos-maquinas-2">
                        <div class="titulos-maquina-atribuicao">
                            <p>Senha funcionário</p>
                        </div>
                        <input placeholder="Ex: ******" type="password" id="input_senha_func">
                        <div class="titulos-maquina-atribuicao">
                            <p>Confirmar senha</p>
                        </div>
                        <input placeholder="Ex: ******" type="password" id="input_repetir_func">
                        <br>

                    </div>
                </div>
                <div class="cadastrar-func-terceiro">
                    <button onclick="confirmar_cadastrar_gefunc()" class="confirmar-func">Confirmar cadastro</button>
                    <button onclick="cancelar_cadastrar_gefunc()" class="cancelar-func">X</button>
                </div>
            </div>




                <div class="Editaratribuicaofunc">
                    <h1>Editar atribuição de servidores</h1>
                    <div class="dash-func-atribuicao">
                        <div class="titulos-func-atribuicao">
                            <div class="coluna-func">ID</div>
                            <div class="coluna-func">Máquina</div>
                            <div class="coluna-func">Localidade</div>
                        </div>
                        <div class="linha-func">
                            <img src="./img/Line1cadastro.png" alt="">
                        </div>
                        <div id="func-dados-atribuicao" class="func-dados-atribuicao"></div>
                    </div>
                    <div class="cadastrar-func-a03">
                        <div class="criacaocheck">
                            <input type="checkbox" id="input_criacao">
                            <label for="input_criacao">Confirmar criação</label>
                        </div>
                        <div class="confirmar-func">
                            <button onclick="confirmar_check_func()" class="confirmar-func-a03">Confirmar</button>
                        </div>
                        <div class="confirmar-func">
                            <button onclick="cancelar_check_func()" class="cancelar-func-a03">Cancelar</button>
                        </div>
                    </div>

                </div>
<div class="Editaratribuicaofunc">
    <h1>Editar atribuição de servidores</h1>
    <div class="dash-func-atribuicao">
        <div class="titulos-func-atribuicao">
            <div class="coluna-func">ID</div>
            <div class="coluna-func">Máquina</div>
            <div class="coluna-func">Localidade</div>
        </div>
        <div class="linha-func">
            <img src="./img/Line1cadastro.png" alt="">
        </div>
        <div id="func-dados-atribuicao" class="func-dados-atribuicao"></div>
    </div>
    <div class="cadastrar-func-a03">
        <div class="criacaocheck">
            <input type="checkbox" id="input_criacao">
            <label for="input_criacao">Confirmar criação</label>
        </div>
        <div class="confirmar-func">
            <button onclick="confirmar_check_func()" class="confirmar-func-a03">Confirmar</button>
        </div>
        <div class="confirmar-func">
            <button onclick="cancelar_check_func()" class="cancelar-func-a03">Cancelar</button>
        </div>
    </div>
</div>


        </section>
</body>

</html>

<script>

    function cancelar_filtro() {
        document.querySelector('.mainfuncpage').style.filter = "blur(0px)";
        document.querySelector('.dialogodefiltromaquina').style.display = "none";
    }

    function selectFiltro() {
        var select = document.getElementById('select2');
        var valor = select.value;


        document.querySelector('.particao-maquinafiltro-1').style.display = "none";
        document.querySelector('.particao-maquinafiltro-2').style.display = "none";
        document.querySelector('.particao-maquinafiltro-3').style.display = "none";

        if (valor === "valor1") {
            document.querySelector('.particao-maquinafiltro-1').style.display = "block";
        } else if (valor === "valor2") {
            document.querySelector('.particao-maquinafiltro-2').style.display = "block";
        } else if (valor === "valor3") {
            document.querySelector('.particao-maquinafiltro-3').style.display = "block";
        }
    }

    document.getElementById('open_btn').addEventListener('click', function () {
        document.getElementById('sidebar').classList.toggle('open-sidebar');
    });
    var tipoUser = sessionStorage.TIPO_USUARIO;
    var idEmpresaUsuario = sessionStorage.EMPRESA_USUARIO
    var idUsuario = "";

    function sair() {
        window.location.href = "index.html";
    }

    function filtrarporfunc() {
        document.querySelector('.mainfuncpage').style.filter = "blur(5px)";
        document.querySelector('.dialogodefiltromaquina').style.display = "block";
    }

    function confirmar_editar_gefunc() {
        // temporario
        document.querySelector('.mainfuncpage').style.filter = "blur(0px)";
        document.querySelector('.Editarfunc').style.display = "none";
    }

    function cancelar_editar_gefunc() {
        // temporario
        document.querySelector('.mainfuncpage').style.filter = "blur(0px)";
        document.querySelector('.Editarfunc').style.display = "none";
    }

    function excluir_editar_gefunc() {
        var r = confirm("Tem certeza que deseja excluir este perfil?");
        if (r == true) {
            if (idUsuario != sessionStorage.ID_USUARIO) {
                deletarUsuario();
                window.location.reload(true);
            } else {
                alert("Não é possivel deletar o seu usuário!")
            }
        }
    }

    function confirmar_cadastrar_gefunc() {
        cadastrarUsuario()
        window.location.reload(true);
    }


    function cancelar_cadastrar_gefunc() {
        // temporario
        document.querySelector('.mainfuncpage').style.filter = "blur(0px)";
        document.querySelector('.Cadastrarfunc').style.display = "none";
    }

    function editar_gefunc() {
        // temporario
        document.querySelector('.mainfuncpage').style.filter = "blur(5px)";
        document.querySelector('.Editarfunc').style.display = "block";

    }

    function cadastrar_gefunc() {
        document.querySelector('.mainfuncpage').style.filter = "blur(5px)";
        document.querySelector('.Cadastrarfunc').style.display = "block";

    }

    function fechar_gefunc() {
        document.querySelector('.mainfuncpage').style.filter = "blur(0px)";
        document.querySelector('.Editarfunc').style.display = "none";
    }

    function atribuicao_editar_gefunc() {
        var r = confirm("Tem certeza que deseja alterar este perfil?");
        if (r == true) {
            editarusuario();
        } else {
            alert("Algo deu errado na alteração de perfil!");
        }
    }

    function atribuicao_maquina_gefunc() {
        document.querySelector('.Editarfunc').style.filter = "blur(5px)";
        document.querySelector('.Editaratribuicaofunc').style.display = "block";
    }


    function cancelar_check_func() {
        document.querySelector('.Editarfunc').style.filter = "blur(0px)";
        document.querySelector('.Editaratribuicaofunc').style.display = "none";
    }

    function confirmar_check_func() {
        window.location.reload(true);
    }

    document.querySelectorAll('.dados-func-atribuicao').forEach(div => {
        div.addEventListener('click', () => {
            var checkbox = div.querySelector('input[type="checkbox"]');
            if (checkbox) {
                checkbox.checked = !checkbox.checked;
                if (checkbox.checked) {
                    div.style.backgroundColor = '#E3E3E3';
                } else {
                    div.style.backgroundColor = '';
                }
            }
        });
    });

    function limparListaUsuarios() {
        var lista = document.getElementById("dash-func");
        lista.innerHTML = '';
    }

    function verUsuarios() {
        fetch("/usuarios/visualizarUsuarios", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idEmpresaUsuarioServer: idEmpresaUsuario
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {

                    if (resposta.status == 204) {
                        var lista = document.getElementById("dash-func");
                        var mensagem = document.createElement("span");
                        mensagem.innerHTML = "Nenhuma empresa encontrada."
                        lista.appendChild(mensagem);
                        throw "Nenhuma resultada encontrada!!";
                    }

                    resposta.json().then(function (resposta) {
                        console.log("Dados recebidos: ", JSON.stringify(resposta));

                        var lista = document.getElementById("dash-func");


                        for (let i = 0; i < resposta.length; i++) {

                            let tupla = resposta[i];
                            var divLista = document.createElement("div");
                            var divId = document.createElement("div");
                            var divnome = document.createElement("div");
                            var divEmail = document.createElement("div");
                            var divCargo = document.createElement("div");

                            divLista.className = "dados-func";
                            divId.className = "coluna-func";
                            divnome.className = "coluna-func";
                            divEmail.className = "coluna-func";
                            divCargo.className = "coluna-func";

                            divId.innerHTML = tupla.idUsuario;
                            divnome.innerHTML = tupla.nomeUsuario;
                            divEmail.innerHTML = tupla.emailUsuario;
                            divCargo.innerHTML = tupla.tipoPerfilUsuario;

                            divLista.appendChild(divId);
                            divLista.appendChild(divnome);
                            divLista.appendChild(divEmail);
                            divLista.appendChild(divCargo);
                            lista.appendChild(divLista);


                            let debounceTimeout;
                            divLista.addEventListener("click", function () {
                                if (debounceTimeout) {
                                    clearTimeout(debounceTimeout);
                                }

                                debounceTimeout = setTimeout(function () {
                                    gerenciarUsuario(tupla.idUsuario);
                                }, 200);
                            });

                            lista.appendChild(divLista);
                        }

                    });
                } else {
                    throw ('Houve um erro na API!');
                }
            }).catch(function (resposta) {
                console.error(resposta);
            });
    }


    function verMaquinas() {
        fetch("/usuarios/visualizarMaquinas", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idEmpresaUsuarioServer: idEmpresaUsuario
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);
                if (resposta.ok) {
                    if (resposta.status == 204) {
                        var lista = document.getElementById("func-dados-atribuicao");
                        var mensagem = document.createElement("span");
                        mensagem.innerHTML = "Nenhuma máquina encontrada.";



                        lista.appendChild(mensagem);
                        throw "Nenhum resultado encontrado!!";
                    }
                    resposta.json().then(function (resposta) {
                        console.log("Dados recebidos: ", JSON.stringify(resposta));
                        var lista = document.getElementById("func-dados-atribuicao");
                        lista.innerHTML = '';
                        for (let i = 0; i < resposta.length; i++) {
                            let tupla = resposta[i];
                            var divLista = document.createElement("div");
                            var checkbox = document.createElement("input");
                            var divId = document.createElement("div");
                            var divMaquina = document.createElement("div");
                            var divLocalidade = document.createElement("div");

                            divLista.className = "dados-func-atribuicao";
                            checkbox.type = "checkbox";
                            checkbox.id = "input_cadastro_checkbox";
                            checkbox.value = tupla.idMaquina;
                            divId.className = "coluna-func-atribuicao";
                            divMaquina.className = "coluna-func-atribuicao";
                            divLocalidade.className = "coluna-func-atribuicao";

                            divId.innerHTML = tupla.idMaquina;
                            divMaquina.innerHTML = tupla.nomeMaquina;
                            divLocalidade.innerHTML = tupla.localidade;

                            divLista.appendChild(checkbox);
                            divLista.appendChild(divId);
                            divLista.appendChild(divMaquina);
                            divLista.appendChild(divLocalidade);
                            let debounceTimeout;
                            divLista.addEventListener("click", function () {
                                if (debounceTimeout) {
                                    clearTimeout(debounceTimeout);
                                }

                                debounceTimeout = setTimeout(function () {
                                    alert(input_cadastro_checkbox.value);
                                }, 200);
                            });
                            lista.appendChild(divLista);

                            lista.value = tupla.idMaquina;

                        }
                    });
                } else {
                    throw ('Houve um erro na API!');
                }
            }).catch(function (resposta) {
                console.error(resposta);
            });
    }

    function selectFiltro() {
        var select = document.getElementById('select2');
        var valor = select.value;

        document.querySelector('.particao-maquinafiltro-1').style.display = "none";
        document.querySelector('.particao-maquinafiltro-2').style.display = "none";
        document.querySelector('.particao-maquinafiltro-3').style.display = "none";

        if (valor === "valor1") {
            document.querySelector('.particao-maquinafiltro-1').style.display = "block";
        } else if (valor === "valor2") {
            document.querySelector('.particao-maquinafiltro-2').style.display = "block";
        } else if (valor === "valor3") {
            document.querySelector('.particao-maquinafiltro-3').style.display = "block";
        }
    }

    function toggleCheckbox(currentCheckbox) {
        var checkboxes = document.querySelectorAll('.particao2-inputcheckbox input[type="checkbox"]');
        checkboxes.forEach(function (checkbox) {
            checkbox.checked = false;
        });
        currentCheckbox.checked = true;
    }

    function confirmar_filtrar() {
        var cargo = document.querySelector('select[name="select1"]').value;
        var maquina = document.querySelector('select[name="select2"]').value;
        var filtro = document.getElementById('select2').value;


        cancelar_filtro();
    }

    function filtrarCargo() {
        fetch("/filtro/filtrarUsuarioCargo", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idEmpresaUsuarioServer: idEmpresaUsuario,
                cargoUsuarioServer: tipoUser

            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    if (resposta.status == 204) {




                    } else {
                        throw ('Houve um erro na API!');
                    }
                }
            })
            .catch(function (resposta) {
                console.error(resposta);
            });
    }


    function filtrarADM() {
        fetch("/usuarios/visualizarUsuariosADM", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idEmpresaUsuarioServer: idEmpresaUsuario
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {

                    if (resposta.status == 204) {
                        var lista = document.getElementById("dash-func");
                        var mensagem = document.createElement("span");
                        mensagem.innerHTML = "Nenhuma empresa encontrada."
                        lista.appendChild(mensagem);
                        throw "Nenhuma resultada encontrada!!";
                    }

                    resposta.json().then(function (resposta) {
                        console.log("Dados recebidos: ", JSON.stringify(resposta));

                        var lista = document.getElementById("dash-func");


                        for (let i = 0; i < resposta.length; i++) {

                            var tupla = resposta[i];
                            var divLista = document.createElement("div");
                            var divId = document.createElement("div");
                            var divnome = document.createElement("div");
                            var divEmail = document.createElement("div");
                            var divCargo = document.createElement("div");

                            divLista.className = "dados-func";
                            divId.className = "coluna-func";
                            divnome.className = "coluna-func";
                            divEmail.className = "coluna-func";
                            divCargo.className = "coluna-func";

                            divId.innerHTML = tupla.idUsuario;
                            divnome.innerHTML = tupla.nomeUsuario;
                            divEmail.innerHTML = tupla.emailUsuario;
                            divCargo.innerHTML = tupla.tipoPerfilUsuario;

                            divLista.appendChild(divId);
                            divLista.appendChild(divnome);
                            divLista.appendChild(divEmail);
                            divLista.appendChild(divCargo);
                            lista.appendChild(divLista);
                        }

                    });
                } else {
                    throw ('Houve um erro na API!');
                }
            }).catch(function (resposta) {
                console.error(resposta);
            });
    }

    function filtrarComum() {
        fetch("/usuarios/visualizarUsuariosCOMUM", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idEmpresaUsuarioServer: idEmpresaUsuario
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {

                    if (resposta.status == 204) {
                        var lista = document.getElementById("dash-func");
                        var mensagem = document.createElement("span");
                        mensagem.innerHTML = "Nenhuma empresa encontrada."
                        lista.appendChild(mensagem);
                        throw "Nenhuma resultada encontrada!!";
                    }

                    resposta.json().then(function (resposta) {
                        console.log("Dados recebidos: ", JSON.stringify(resposta));

                        var lista = document.getElementById("dash-func");


                        for (let i = 0; i < resposta.length; i++) {

                            var tupla = resposta[i];
                            var divLista = document.createElement("div");
                            var divId = document.createElement("div");
                            var divnome = document.createElement("div");
                            var divEmail = document.createElement("div");
                            var divCargo = document.createElement("div");

                            divLista.className = "dados-func";
                            divId.className = "coluna-func";
                            divnome.className = "coluna-func";
                            divEmail.className = "coluna-func";
                            divCargo.className = "coluna-func";

                            divId.innerHTML = tupla.idUsuario;
                            divnome.innerHTML = tupla.nomeUsuario;
                            divEmail.innerHTML = tupla.emailUsuario;
                            divCargo.innerHTML = tupla.tipoPerfilUsuario;

                            divLista.appendChild(divId);
                            divLista.appendChild(divnome);
                            divLista.appendChild(divEmail);
                            divLista.appendChild(divCargo);
                            lista.appendChild(divLista);
                        }

                    });
                } else {
                    throw ('Houve um erro na API!');
                }
            }).catch(function (resposta) {
                console.error(resposta);
            });
    }


    function totalfunc() {
        console.log("Iniciando fetch para totalfunc...");
        fetch("/usuarios/totalfunc", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idEmpresaUsuarioServer: idEmpresaUsuario
            }),
        }).then(function (resposta) {
            console.log("Resposta recebida: ", resposta);
            if (resposta.ok) {
                return resposta.json();
            } else {
                console.error('Erro na resposta:', resposta.statusText);
            }
        }).then(function (total) {
            console.log("Total de funcionários recebido: ", total);
            var totalfuncionarios = document.getElementById("totalfuncionarios");
            if (totalfuncionarios) {
                totalfuncionarios.textContent = total;
                console.log("Texto atualizado: ", totalfuncionarios.textContent);
            } else {
                console.error("Elemento 'totalfuncionarios' não encontrado!");
            }
        }).catch(function (erro) {
            console.error('Erro ao buscar dados:', erro);
        });
    }

    function totaladms() {
        console.log("Iniciando fetch para totaladms...");
        fetch("/usuarios/totaladms", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idEmpresaUsuarioServer: idEmpresaUsuario
            }),
        }).then(function (resposta) {
            console.log("Resposta recebida: ", resposta);
            if (resposta.ok) {
                return resposta.json();
            } else {
                console.error('Erro na resposta:', resposta.statusText);
            }
        }).then(function (total) {
            console.log("Total de administradores recebido: ", total);
            var totalADM = document.getElementById("totaladms");
            if (totalADM) {
                totalADM.textContent = total;
                console.log("Texto atualizado: ", totalADM.textContent);
            } else {
                console.error("Elemento 'totaladms' não encontrado!");
            }
        }).catch(function (erro) {
            console.error('Erro ao buscar dados:', erro);
        });
    }

    function totalanalista() {
        console.log("Iniciando fetch para totalanalista...");
        fetch("/usuarios/totalanalista", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idEmpresaUsuarioServer: idEmpresaUsuario
            }),
        }).then(function (resposta) {
            console.log("Resposta recebida: ", resposta);
            if (resposta.ok) {
                return resposta.json();
            } else {
                console.error('Erro na resposta:', resposta.statusText);
            }
        }).then(function (total) {
            console.log("Total de analistas recebido: ", total);
            var totalAnalista = document.getElementById("totalanalista");
            if (totalAnalista) {
                totalAnalista.textContent = total;
                console.log("Texto atualizado: ", totalAnalista.textContent);
            } else {
                console.error("Elemento 'totalanalista' não encontrado!");
            }
        }).catch(function (erro) {
            console.error('Erro ao buscar dados:', erro);
        });
    }

    function gerenciarUsuario(idUsuarioSelecionado) {
        // Exibe o ID do usuário para confirmação
        idUsuario = idUsuarioSelecionado;
        fetch("/usuarios/exibirDadosEdicaoUsuario", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idUsuarioServer: idUsuarioSelecionado,
            }),
        })
            .then(function (resposta) {
                if (resposta.ok) {
                    resposta.json().then(function (json) {
                        let nomeUsuarioEdicao = json.nomeUsuario;
                        let emailUsuarioEdicao = json.emailUsuario;
                        let senhaUsuarioEdicao = json.senhaUsuario;
                        let cargoUsuarioEdicao = json.tipoPerfilUsuario;

                        document.getElementById("input_alterar_nome").value = nomeUsuarioEdicao;
                        document.getElementById("input_alterar_email").value = emailUsuarioEdicao;
                        document.getElementById("input_alterar_senha").value = senhaUsuarioEdicao;

                        let selectCargo = document.getElementById("select_alterar_cargo");
                        for (let option of selectCargo.options) {
                            if (option.value === cargoUsuarioEdicao) {
                                option.selected = true;
                                break;
                            }
                        }

                        document.querySelector('.mainfuncpage').style.filter = "blur(5px)";
                        document.querySelector('.Editarfunc').style.display = "block";
                    });
                } else {
                    console.error("Houve um erro na requisição");
                }
            })
            .catch(function (erro) {
                console.error("Erro ao tentar buscar os dados do usuário:", erro);
            });

        return false;
    }


    function deletarUsuario() {
        // Exibe o ID do usuário para confirmação

        fetch("/usuarios/deletarusuario", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idUsuarioServer: idUsuario,
            }),
        })
            .then(function (resposta) {
                if (resposta.ok) {
                    resposta.json().then(function (json) {
                        console.log("Usuário deletado com sucesso:", json);
                        verUsuarios();
                    });
                } else {
                    console.error("Houve um erro na requisição");
                }
            })
            .catch(function (erro) {
                console.error("Erro ao tentar deletar o usuário:", erro);
            });

        return false;
    }


    function editarusuario() {
        var nome = document.getElementById("input_alterar_nome").value;
        var email = document.getElementById("input_alterar_email").value;
        var senha = document.getElementById("input_alterar_senha").value;
        var cargo = document.getElementById("select_alterar_cargo").value;

        if (
            nome == "" ||
            email == "" ||
            senha == ""
        ) {
            alert("Todos os campos dever ser preenchidos!")
            return false;
        }

        if (nome == "") {
            alert("Preencha o campo do nome!")
            return false;
        }

        if (email == "") {
            alert("Preencha o campo do email!")
            return false;
        }

        if (senha == "") {
            alert("Preencha o campo da senha!")
            return false;
        }

        console.log("Dados a serem enviados:", {
            idUsuarioServer: idUsuario,
            nomeUsuario: nome,
            emailUsuario: email,
            senhaUsuario: senha,
            tipoPerfilUsuario: cargo
        });

        fetch("/usuarios/editarusuario", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idUsuarioServer: idUsuario,
                nomeUsuario: nome,
                emailUsuario: email,
                senhaUsuario: senha,
                tipoPerfilUsuario: cargo,
            }),
        })
            .then(function (resposta) {
                console.log("Status da resposta:", resposta.status);
                if (resposta.ok) {
                    resposta.json().then(function (json) {
                        console.log("Usuário atualizado com sucesso:", json);
                        alert("Perfil alterado com sucesso!");
                        window.location.reload(true);
                    });
                } else {
                    resposta.text().then(function (texto) {
                        console.error("Erro na resposta:", texto);
                    });
                }
            })
            .catch(function (erro) {
                console.error("Erro ao tentar alterar os dados do usuário:", erro);
            });
    }

    function cadastrarUsuario() {

        var nomeUsuarioVar = input_nome_func.value;
        var emailUsuarioVar = input_email_func.value;
        var senhaUsuarioVar = input_senha_func.value;
        var empresaUsuarioVar = idEmpresaUsuario;
        var tipoUsuarioVar = lista_cargo.value;


        // Verificando se há algum campo em branco

        if (
            nomeUsuarioVar == "" ||
            emailUsuarioVar == "" ||
            senhaUsuarioVar == ""
        ) {
            alert("Todos os campos dever ser preenchidos!")
            return false;
        }

        if (nomeUsuarioVar == "") {
            alert("Preencha o campo do nome!")
            return false;
        }

        if (emailUsuarioVar == "") {
            alert("Preencha o campo do email!")
            return false;
        }

        if (senhaUsuarioVar == "") {
            alert("Preencha o campo da senha!")
            return false;
        }



        if (senhaUsuarioVar != input_repetir_func.value) {
            alert("As senhas não coincidem")
        } else {

            fetch("/usuarios/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({

                    nomeUsuarioServer: nomeUsuarioVar,
                    emailUsuarioServer: emailUsuarioVar,
                    senhaUsuarioServer: senhaUsuarioVar,
                    empresaUsuarioServer: empresaUsuarioVar,
                    tipoUsuariosServer: tipoUsuarioVar

                }),
            })
                .then(function (resposta) {
                    console.log("resposta: ", resposta);

                    if (resposta.ok) {

                        alert("CADASTRO EXECUTADO!")

                    } else {
                        throw "Houve um erro ao tentar realizar o cadastro!";
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);

                });

            return false;
        }
    }



</script>